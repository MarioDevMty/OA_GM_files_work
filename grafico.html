<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Práctica - Gráficas con Blockly</title>
    
    <!-- CSS Organizado -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/pages/teoria.css">
    <link rel="stylesheet" href="css/components/navigation.css">
    <link rel="stylesheet" href="css/components/buttons.css">
    <link rel="stylesheet" href="css/components/cards.css">
    <link rel="stylesheet" href="css/components/blockly-ui.css">
    <link rel="stylesheet" href="css/components/common-components.css">
    <link rel="stylesheet" href="css/components/function-display.css">
    
    <!-- Librerías Blockly -->
    <script src="https://www.google.com/jsapi"></script>
    <script src="https://unpkg.com/blockly@12.0.0/blockly_compressed.js"></script>
    <script src="https://unpkg.com/blockly@12.0.0/blocks_compressed.js"></script>
    <script src="https://unpkg.com/blockly@12.0.0/javascript_compressed.js"></script>
    <script src="https://unpkg.com/blockly@12.0.0/msg/es.js"></script>
    <script src="https://unpkg.com/@blockly/theme-modern@7.0.1/dist/index.js"></script>
    
    <!-- MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- Intro.js para tutorial -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intro.js/7.2.0/intro.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intro.js/7.2.0/introjs.min.css">
</head>

<body>
    <nav class="nav-dots">
        <ul>
            <li><a href="index.html">1</a></li>
            <li><a href="teoria.html">2</a></li>
            <li><a href="grafico.html" class="active">3</a></li>
            <li><a href="aplicacion.html">4</a></li>
            <li><a href="evaluacion.html">5</a></li>
        </ul>
    </nav>

    <main class="main-content">
        <!-- Encabezado con Logos -->
        <div class="logo-container">
            <img src="assets/Uanl-color-negro.png" alt="UANL" class="logo left-logo">
            <img src="assets/Logo-Excelencia-Negro.png" alt="Excelencia" class="logo right-logo">
        </div>

        <div class="content-page"  style="max-width: 100%;"> <!-- ✅ 100% de ancho -->
               <div class="centra-objetos" >
                    <div class="equation-box" style="max-width: 50%;" >
                        <p align-text="center">Usa los bloques para conectar los elementos de una función.</p>
                        <p>Encontrarás lo necesario para realizar las funciones. ¡Diviértete!</p>
                    </div> 
                </div> 
                        <!-- Botón Tutorial -->
                        <div class="center-container">
                            <button id="tutorial-btn" class="action-btn">Iniciar Tutorial</button>
                        </div>
                </div>
            
            
            <hr>

            <!-- Ejemplos para Practicar -->
            <div class="examples-container">
                <h2>Ejemplos para practicar y comprender</h2>
                
                <div class="example-nav">
                    <button data-example="1" class="active">1</button>
                    <button data-example="2">2</button>
                    <button data-example="3">3</button>
                    <button data-example="4">4</button>
                    <button data-example="5">5</button>
                </div>
                
                <div class="examples-content-wrapper">
                    <!-- Ejemplos aquí (igual que antes) -->
                    <div id="example-1" class="example active">
                        <table>
                            <thead>
                                <tr>
                                    <th>Función</th>
                                    <th>Bloques</th>
                                    <th>Gráfica</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <div class="example-title">$$y = x - 2$$</div>
                                    </td>
                                    <td>
                                        <div class="example-blocks">
                                            <img src="assets/bloque_y=x-2.png" alt="Bloques para y=x-2">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="example-graph">
                                            <img src="assets/grafica_y=x-2.png" alt="Gráfica para y=x-2">
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Resto de ejemplos... -->
                </div>
            </div>

            <!-- Display de Función -->
            <div id="functionDisplay" class="function-display"></div>

            <!-- Área de Trabajo: Blockly + Gráfica - DISTRIBUCIÓN 60%/40% -->
            <div class="blockly-and-graph-container">
                <div id="blocklyDiv" style="height: 500px; flex: 3;"></div> <!-- ✅ 60% -->
                <div id="visualization" style="height: 500px; flex: 2;"></div> <!-- ✅ 40% -->
            </div>

            <!-- Botones de Control -->
            <div class="button-group">
                <button id="clear-btn" class="action-btn secondary-btn">Limpiar Bloques</button>
                <button id="reset-graph-btn" class="action-btn secondary-btn">Reiniciar Gráfica</button>
            </div>
        </div>
    </main>

    <!-- Bloques iniciales para y = x² -->
    <xml id="startBlocks" style="display: none">
        <block type="graph_set_y1" deletable="false" x="100" y="100">
            <value name="VALUE">
                <block type="math_arithmetic">
                    <field name="OP">POWER</field>
                    <value name="A">
                        <block type="graph_get_x"></block>
                    </value>
                    <value name="B">
                        <block type="math_number">
                            <field name="NUM">2</field>
                        </block>
                    </value>
                </block>
            </value>
        </block>
    </xml>

    <!-- JavaScript (igual que antes) -->
    <script src="js/core/blockly-core.js"></script>
    <script src="js/core/chart-core.js"></script>
    <script src="js/core/math-utils.js"></script>
    <script src="js/core/navigation.js"></script>
    <script src="js/components/function-display.js"></script>
    <script src="js/components/examples-manager.js"></script>
    <script src="js/components/blockly-setup.js"></script>
    <script src="js/pages/grafico.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            NavigationManager.init();
            
            document.querySelectorAll('.example-nav button').forEach(button => {
                button.addEventListener('click', function() {
                    const exampleNumber = parseInt(this.dataset.example);
                    ExamplesManager.showExample(exampleNumber);
                });
            });
            
            document.getElementById('tutorial-btn').addEventListener('click', function() {
                GraficoPage.startTutorial();
            });
            
            document.getElementById('clear-btn').addEventListener('click', function() {
                GraficoPage.clearWorkspace();
            });
            
            document.getElementById('reset-graph-btn').addEventListener('click', function() {
                GraficoPage.setupInitialGraph();
            });
        });

        // Sobrescribir setupPage para cargar y = x²
        GraficoPage.setupPage = function() {
            try {
                if (!ChartManager.initialize()) return;

                this.workspace = BlocklyConfig.initializeWorkspace('blocklyDiv');
                
                const startBlocks = document.getElementById('startBlocks');
                if (startBlocks) {
                    Blockly.Xml.domToWorkspace(startBlocks, this.workspace);
                    this.workspace.clearUndo();
                }

                FunctionDisplay.init('functionDisplay');
                ExamplesManager.init();
                this.setupEventListeners();
                this.setupInitialGraph();
                
                this.isInitialized = true;
                
            } catch (error) {
                console.error('Error al inicializar página gráfico:', error);
            }
        };
    </script>
</body>
</html>